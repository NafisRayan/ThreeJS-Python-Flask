<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Only keeping styles that can't be easily replicated with Tailwind */
        #webgl {
            z-index: 10;
        }
        
        /* Optional: Configure Tailwind */
        @layer utilities {
            .renderer-container {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100vh;
            }
        }
    </style>
</head>
<body class="m-0 p-0 bg-red-500">
    <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

    <script type="importmap">
        {
            "imports": {
                "three": "https://threejs.org/build/three.module.js"
            }
        }
    </script>

    <div id="container" class="absolute top-0 w-full h-screen">
        <div id="css3d" class="renderer-container"></div>
        <div id="webgl" class="renderer-container"></div>
    </div>

    <script type="module">
        import * as three from "https://threejs.org/build/three.module.js";
        import Stats from "https://threejs.org/examples/jsm/libs/stats.module.js";
        import {
            CSS3DRenderer,
            CSS3DObject
        } from "https://threejs.org/examples/jsm/renderers/CSS3DRenderer.js";
        import { GUI } from "https://threejs.org/examples/jsm/libs/lil-gui.module.min.js";
        import { OrbitControls } from "https://threejs.org/examples/jsm/controls/OrbitControls.js";
        import { GLTFLoader } from "https://threejs.org/examples/jsm/loaders/GLTFLoader.js";

        var THREE = { ...three };
        let scene,
            scene2,
            renderer,
            rendererCss,
            camera,
            stats,
            axesHelper,
            controls,
            controls2;

        let css3dContainer, webglContainer;

        init();
        animate();

        function init() {
            const container = document.getElementById("container");

            webglContainer = document.getElementById("webgl");
            css3dContainer = document.getElementById("css3d");

            setupCamera();
            setupScene();
            setupRenderer();

            // ORBIT CONTROLS
            controls = new OrbitControls(camera, renderer.domElement);
            controls2 = new OrbitControls(camera, rendererCss.domElement);

            // STATS PANEL
            stats = new Stats();
            container.appendChild(stats.dom);

            // onResize
            window.addEventListener("resize", onWindowResize);
        }

        function animate() {
            requestAnimationFrame(animate);
            stats.update();
            renderer.render(scene, camera);
            rendererCss.render(scene2, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            rendererCss.setSize(window.innerWidth, window.innerHeight);
        }

        function setupCamera() {
            camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(1, 1, 1);
            camera.lookAt(0, 0, 0);
        }

        function setupScene() {
            scene = new THREE.Scene();
            scene2 = new THREE.Scene();

            axesHelper = new THREE.AxesHelper();
            scene.add(axesHelper);

            const boxgeom = new THREE.BoxGeometry(0.25, 0.25, 0.25);
            var mesh = new THREE.Mesh(boxgeom, new THREE.MeshNormalMaterial());
            mesh.position.x += 0.5;
            mesh.position.z += 0.5;
            scene.add(mesh);

            const sphere = new THREE.OctahedronGeometry(0.25);
            mesh = new THREE.Mesh(sphere, new THREE.MeshNormalMaterial());
            mesh.position.x -= 0.5;
            mesh.position.z += 0.1;
            scene.add(mesh);

            const group = new THREE.Group();
            const object = new Element("SJOz3qjfQXU", 0, 0, 0, 0);
            group.add(object);

            // Create GL plane
            const material = new THREE.MeshLambertMaterial();
            material.side = THREE.DoubleSide;
            material.opacity = 0;
            material.transparent = true;
            material.blending = THREE.NoBlending;
            
            const geometry = new THREE.PlaneGeometry(480, 360);
            const meshBlend = new THREE.Mesh(geometry, material);
            meshBlend.position.copy(object.position);
            meshBlend.rotation.copy(object.rotation);
            meshBlend.scale.copy(object.scale);
            
            scene.add(meshBlend);
            scene2.add(group);
        }

        function Element(id, x, y, z, ry) {
            const div = document.createElement("div");
            div.className = "w-[480px] h-[360px] bg-black";

            const iframe = document.createElement("iframe");
            iframe.className = "w-[480px] h-[360px] border-0";
            iframe.src = ["https://www.youtube.com/embed/", id, "?rel=0"].join("");
            div.appendChild(iframe);

            const object = new CSS3DObject(div);
            object.scale.multiplyScalar(0.003);

            return object;
        }

        function setupRenderer() {
            rendererCss = new CSS3DRenderer();
            rendererCss.setSize(window.innerWidth, window.innerHeight);
            
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.outputEncoding = THREE.sRGBEncoding;
            renderer.shadowMap.enabled = true;
            
            css3dContainer.appendChild(rendererCss.domElement);
            webglContainer.appendChild(renderer.domElement);
        }
    </script>
</body>
</html>